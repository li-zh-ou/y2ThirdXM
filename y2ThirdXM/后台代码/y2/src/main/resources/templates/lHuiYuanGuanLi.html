<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>会员管理</title>
<link rel="stylesheet" type="text/css" th:href="@{/css/bootstrap.min.css}"/>
</head>
<body>
		<div id="huiyuanapp">
			<div>
				<div class="row" style="border-bottom: solid 1px;">
					<h3 class="col-xs-offset-1 col-xs-9">会员管理</h3>
					<p class="col-xs-2"><button class="btn btn-success" style="margin-top: 15px;">关闭</button></p>
				</div>
				<div style="padding: 20px 30px;">
					<p style="text-align: right;font-size: 16px;font-weight: 600;">
						<a href="javascript:void(0)">加入会员</a>
						<a href="javascript:void(0)" onclick="hyChongZhi()">会员充值</a>
						<a href="javascript:void(0)" onclick="zhuxiaoHY()">会员注销</a>
					</p>
				</div> 
				<div class="row" style="margin-top: 30px;">
					<p class="col-xs-4 col-xs-offset-1">
						<label><span>姓名/编号</span><input type="text" name="huiyuanno" placeholder="匹配客户姓名/编号/会员号"></label>
					</p>
					<p class="col-xs-3">
						<label>
							<span>性别</span>
							<select style="padding: 3px 0; width: 180px;">
								<option>请选择</option>
								<option>男</option>
								<option>女</option>
							</select>
						</label>
					</p>
					<p class="col-xs-3">
						<label>
							<span>排序方式</span>
							<select style="padding: 3px 0; width: 180px;">
								<option>请选择</option>
								<option>男</option>
								<option>女</option>
							</select>
						</label>
					</p>
				</div>
				<!-- 会员信息列表 -->
				<div >
					<table class="table table-hover table-bordered text-center " style="width: 90%;margin-left:5%;margin-right:5%;">
						<thead>
							<tr>
								<td></td>
								<th class="text-center">客户编号</th>
								<th class="text-center">客户名称</th>
								<th class="text-center">会员卡号</th>
								<th class="text-center">会员余额</th>
								<th class="text-center">会员等级</th>
								<th class="text-center">消费金额</th>
								<th class="text-center">积分</th>
								<th class="text-center">优惠</th>
							</tr>
						</thead>
						<tbody>
							<tr v-for="item,index in allhy.list" ondblclick="tableDblclick(this)" onclick="tableClick(this)">
								<td><input type="radio" name="hyradio"  disabled="disabled"></td>
								<td class="text-center">{{item.kehuno}}</td>
								<td class="text-center">{{item.huiyuanname}}</td>
								<td class="text-center">{{item.huiyuanno}}</td>
								<td class="text-center">{{item.huiyuanmoney}}</td>
								<td class="text-center">{{item.huiyuangraden}}</td>
								<td class="text-center">{{item.xiaofei}}</td>
								<td class="text-center">{{item.jifen}}</td>
								<td class="text-center">{{item.youhui}}</td>
							</tr>
						</tbody>
					</table>
					<div class="btn-group" role="group" style="margin-left: 40%;">
						<button type="button" class="btn btn-default" onclick="pageQuery(1,10)">首页</button>
					  	<button type="button" class="btn btn-default">《</button>
					  	<button type="button" class="btn btn-default">{{allhy.pageNum}}/{{allhy.lastPage}}</button>
					  	<button type="button" class="btn btn-default">》</button>
					  	<button type="button" class="btn btn-default" onclick="pageQuery(allhy.lastPage,10)">末页</button>
					</div>
				</div>
			</div>
			
			
			<!-- 模态框部分 -->
			<div class="modal" tabindex="-1" role="dialog" id="huiyuanModal">
			  	<div class="modal-dialog" role="document">
			    	<div class="modal-content">
			      		<div class="modal-header">
					        <button type="button" class="close" data-dismiss="modal" aria-label="close"><span aria-hidden="true">&times;</span></button>
					        <div class="row">
					        	<h3 class="modal-title col-xs-9">会员信息</h3>
					        </div>
			      		</div>
				      	<div class="modal-body row" style="font-size: 17px;">
				      		<p class="col-xs-12">客户姓名：<strong>{{huiyuaninfo.huiyuanname}}</strong></p>
				      		<p class="col-xs-6">入会时间：<span style="font-weight: 700;font-size:15px;color:green;">{{huiyuaninfo.ruhuitime}}</span></p>
				      		<p class="col-xs-6">到期时间：<span style="font-weight: 700;font-size:15px;color:red;">{{huiyuaninfo.daoqitime}}</span></p>
							<p class="col-xs-12" style="height: 25px;border-bottom:1px solid;"></p>
				      		<p class="col-xs-6"></p>
				      		<p class="col-xs-6" style="font-size:17px;font-weight: 700;">会员卡号：{{huiyuaninfo.huiyuanno}}</p>
				      		<p class="col-xs-4" style="font-size:16px;font-weight: 600;">会员等级：{{huiyuaninfo.huiyuangraden}}</p>
				      		<p class="col-xs-5" style="font-size:16px;font-weight: 600;">账户余额：{{huiyuaninfo.huiyuanmoney}}</p>
				      		<p class="col-xs-3" style="font-size:16px;font-weight: 600;">优惠：{{huiyuaninfo.youhui}}折</p>
				      		<p class="col-xs-6" style="font-size:16px;font-weight: 600;">消费总金额：{{huiyuaninfo.xiaofei}}</p>
				      		<p class="col-xs-6" style="font-size:16px;font-weight: 600;">积分：{{huiyuaninfo.jifen}}</p>
				      	</div>
			    	</div><!-- /.modal-content -->
			  	</div><!-- /.modal-dialog -->
			</div><!-- /.modal -->
			
			<!-- 会员充值模态框 -->
			<div class="modal" tabindex="-1" role="dialog" id="huiyuanCZ">
			  	<div class="modal-dialog modal-lg" role="document">
			    	<div class="modal-content">
			      		<div class="modal-header">
					        <button type="button" class="close" data-dismiss="modal" aria-label="close"><span aria-hidden="true">&times;</span></button>
					        <div class="row">
					        	<h3 class="modal-title col-xs-9">会员充值</h3>
					        </div>
			      		</div>
				      	<div class="modal-body row" style="font-size: 17px;">
				      		<table border="1" style="margin-left: 30px;">
				      			<tr>
				      				<th width="120px">会员卡号</th>
				      				<td width="250px">{{huiyuaninfo.huiyuanno}}</td>
				      				<th width="120px">会员姓名</th>
				      				<td width="250px">{{huiyuaninfo.huiyuanname}}</td>
				      			</tr>
				      			<tr>
				      				<th>会员余额</th>
				      				<td>{{huiyuaninfo.huiyuanmoney}}</td>
				      				<th>会员积分</th>
				      				<td>{{huiyuaninfo.jifen}}</td>
				      			</tr>
				      			<tr>
				      				<th>入会日期</th>
				      				<td>{{huiyuaninfo.ruhuitime}}</td>
				      				<th>到期日期</th>
				      				<td>{{huiyuaninfo.daoqitime}}</td>
				      			</tr>
				      			<tr>
				      				<th>会员等级</th>
				      				<td>{{huiyuaninfo.huiyuangraden}}</td>
				      				<th>会员折扣</th>
				      				<td>{{huiyuaninfo.youhui}}</td>
				      			</tr>
				      		</table>
				      		<div>
				      			<h4><a href="javaScript:void(0)">余额充值</a></h4>
				      			<div id="yuecz" class="row">
				      				<p class="col-xs-offset-1 col-xs-5">
				      					当前余额：<input name="dangqianyue" type="number" v-model="huiyuaninfo.huiyuanmoney" disabled="disabled"></p>
				      				<p class="col-xs-6"><label>充值金额：<input name="chongzhijine" type="number" onblur="czNumberBlur()" min="0" max="50000"></label></p>
				      				<p class="col-xs-offset-6 col-xs-6">之后金额：<input name="zhihouyue" type="number" disabled="disabled"></p>
				      				<button class="btn btn-success col-xs-offset-10" onclick="chongzhiButton()">确定充值</button>
				      			</div>
				      			<h4><a href="javaScript:void(0)" onclick="hyyuecz()">会员延期</a></h4>
				      			<div id="hyyanqi" class="row">
				      				<p class="col-xs-offset-1 col-xs-5"><label><span>延期时长：</span><select name="yanqishichang" onchange="yqSelectChange()">
				      					<option value="0">请选择延期时长</option>
				      					<option value="50">一年</option>
				      					<option value="80">三年</option>
				      					<option value="120">五年</option>
				      				</select></label></p>
				      				<p>应付金额：<input name="yanqiyingfu" type="number" disabled="disabled"></p>
				      				<button class="btn btn-success col-xs-offset-10" onclick="yanqiButton()">确定延期</button>
				      			</div>
				      		</div>
				      	</div>
			    	</div><!-- /.modal-content -->
			  	</div><!-- /.modal-dialog -->
			</div><!-- /.modal -->
		</div>
</body>
	<script type="text/javascript" th:src="@{/js/jquery-3.4.1.min .js}" ></script>
	<script type="text/javascript" th:src="@{/js/vue.js}"></script>
	<script type="text/javascript" th:src="@{/js/bootstrap.min.js}" ></script>
	<script>
		var vm =new Vue({
			el:"#huiyuanapp",
			data(){
				return {
					allhy:[],
					huiyuaninfo:{},
				}
			}
		})
		var timeoutID = null;
		function tableClick(item){
			clearTimeout(timeoutID);
			timeoutID = window.setTimeout(function (){
				  var index = $(item).index();
				  if($("[name='hyradio']")[index].checked){
					  $("[name='hyradio']")[index].checked=false;
				  }else{
					  $("[name='hyradio']")[index].checked=true;
				  }
			},300);
		}
		// table的双击选中tr,并取出td的值
		function tableDblclick(huiyuanitem){
			clearTimeout(timeoutID); 
			//获取子元素td的文本
			/*var item = $(huiyuanitem).find("td");
			var hyobj={kehuno:item[1].textContent,kehuname:item[2].textContent,huiyuanno:item[3].textContent,huiyuanmoney:parseFloat(item[4].textContent),huiyuandraden:item[5].textContent,xiaofei:parseFloat(item[6].textContent),jifen:parseFloat(item[7].textContent),youhui:parseFloat(item[8].textContent)};
			var newhyobj=JSON.parse(JSON.stringify(hyobj));
			console.log(newhyobj);
			vm.huiyuaninfo=newhyobj;
			$("#huiyuanModal").modal("show");*/
			var index = $(huiyuanitem).index();
			vm.huiyuaninfo=vm.allhy.list[index];
			$("#huiyuanModal").modal("show");
		}
		//注销会员
		// table中的radio选中,获取对应tr的信息 -
		function zhuxiaoHY(){
			if($("input:checked").length==0){
				alert("没有选中任何信息！");
				return;
			}else{
				var info = $("input:checked")[0].parentElement.parentElement.children;
			}
		}
		//会员充值
		function hyChongZhi(){
			if($("input:checked").length==0){
				alert("没有选中任何信息！");
				return;
			}else{
				for(var i=0;i<$("[name='hyradio']").length;i++){
					if($("[name='hyradio']")[i].checked){
						vm.huiyuaninfo=vm.allhy.list[i];
					}
				}
				$("#huiyuanCZ").modal("show");
			}
		}
		//会员充值，充值金额number框blur事件函数
		function czNumberBlur(){
			if(isNaN(parseFloat($("[name='chongzhijine']").val()))){
				$("[name='chongzhijine']").val(0);
			}else if(parseFloat($("[name='chongzhijine']").val())<0){
				$("[name='chongzhijine']").val(0);
			}else if(parseFloat($("[name='chongzhijine']").val())>100000){
				$("[name='chongzhijine']").val(100000);
			}
			var he = parseFloat($("[name='dangqianyue']").val())+parseFloat($("[name='chongzhijine']").val());
			$("[name='zhihouyue']").val(he);
		}
		//会员充值，会员延期下拉框change事件函数
		function yqSelectChange(){
			$("[name='yanqiyingfu']").val(parseFloat($("[name='yanqishichang']").val()));
		}
		//会员充值，确定充值button按钮click事件函数
		function chongzhiButton(){
			if($("[name='chongzhijine']").val()=="0"||$("[name='chongzhijine']").val()==""){
				alert("请选择充值金额");
			}else{
				var isTrue = confirm("确定充值吗？");
				if(isTrue){
					var chongzhijine = $("[name='chongzhijine']").val();
					$("[name='chongzhijine']").val(null)
					$("[name='zhihouyue']").val(null)
				}
			}
		}
		//会员充值，确定延期button按钮click事件函数
		function yanqiButton(){
			if($("[name='yanqishichang']").val()=="0"){
				alert("请选择延期时长");
			}else{
				var isTrue = confirm("确定延期吗？");
				if(isTrue){
					var yanqishichang=$("[name='yanqishichang']").val();
					document.getElementsByName("yanqishichang")[0].selectedIndex=0;
				}
			}
		}
		function pageQuery(pageNum,pageSize){
			$.ajax({
				"url":"[[@{/huiyuan/queryAllHuiYuan}]]",
				"data":"pageNum="+pageNum+"&pageSize="+pageSize,
				"type":"post",
				"dataType":"json",
				"success":function(result){
					vm.allhy = result;
				},
				"error":function(){
					
				}
			})
		}
		
		$(function(){
			pageQuery(1,10);
			
		})
	</script>
</html>