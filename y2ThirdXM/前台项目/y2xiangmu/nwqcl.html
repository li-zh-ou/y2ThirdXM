<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title></title>
		<link rel="stylesheet" href="css/bootstrap.min.css" />
		<link rel="stylesheet" href="fonts/font_4aigx4do0lb/iconfont.css" />
		<link rel="stylesheet" href="css/bootstrapStyle/bootstrapStyle.css" type="text/css">
		<style>
			
			#tbss{
				padding: 1em 2em;
				display: flex;
			}
			
			.shang{
			    margin-top: 10px;
			    padding-top: 10px;
			    padding-left:15px;
		   	}
		   	
		   	.guan{
			    font-size: 35px;
			}
			
			#a{
				 color:#EA0000;
			}
			
			#bt{
				background:#4b6cb7;
			}
			
			#c{
				background:#bdc3c7;
			}
			
			#ctx{
				background:#f5f5f5;
			}
			
			#ctx1{
				background:#ffffff;
			}
		
		</style>
	</head>
	<body>
	<div id="ctx">
		<!--选择班组-->
			<div class="modal fade" tabindex="-1" role="dialog" id="xzbz">
			<div class="modal-dialog" role="document" style="width:300px;">
				<div class="modal-content">
					<div class="modal-header" style="height: 60px;">
	           			<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true" class="guan">&times;</span></button>
	           			<h4 class="modal-title" style="margin-top:5px;">选择班组</h4>
			           	<div >
			             	<button type="button" class="btn btn-success" data-dismiss="modal" style="margin-top: -50px;margin-left: 180px; vertical-align: middle; width: 60px;" >确定</button>
			          	</div>
     				</div>
					<div class="row modal-body"  style="margin-top: -20px; ">
						<div class="shang">
							
							<div class="col-md-2"></div>
							<div class="col-md-8" style="border: 1px solid #E6E6E6;">
								
								<ul id="treeDemo" class="ztree"></ul>
								
							</div>
							<div class="col-md-2"></div>
					
						</div>
					</div>
				</div>
			</div>
		</div>
		

		<div>
			<div id="bt" class="row" style="border: 1px solid #E6E6E6;" >
					<h3 class="col-md-11">外勤车辆</h3>
					<div class="col-md-1" id="tbss">
						<button type="button" class="btn btn-default" >关闭</button>
					</div>
			</div>
			
			<div style="height:51px;">

				<ol class="breadcrumb">
					<li v-perms="'addwaiqin'"><span class="iconfont" style="vertical-align: middle; color:#0071E7; font-size:22px;">&#xe62c;</span><a href="#" style="vertical-align: middle" @click="insert">增加车辆</a></li>
				  	<li v-perms="'deletewaiqin'"><span class="iconfont" style="vertical-align: middle; color:#0071E7; font-size:16px;">&#xe614;</span><a href="#" style="vertical-align: middle" @click="del(hqbmxz.chepai)">删除车辆</a></li>
				  	<li v-perms="'updatewaiqin'"><span class="iconfont" style="vertical-align: middle; color:#0071E7; font-size:25px;">&#xe612;</span><a href="#" style="vertical-align: middle" @click="up">修改车辆</a></li>
				</ol>
				
			</div>
		
			<div>
				
				<table>
					<tr>
						<td class="col-md-2">
							<div class="input-group">
												
								<span id="a" class="input-group-addon" >车牌号码:</span>
								<input v-model="hqbmxz.chepai" type="text" class="form-control" aria-describedby="basic-addon3" style="vertical-align: middle ; width:160px; height:33px;">
										
							</div>
						</td>					
						<td class="col-md-2">
							<div class="input-group">
										
								<span id="a" class="input-group-addon" >车辆品牌:</span>
								<input v-model="hqbmxz.carbank" type="text" class="form-control" aria-describedby="basic-addon3" style="vertical-align: middle ; width:160px; height:33px;">
									
							</div>
						</td>
						<td class="col-md-2">
							<div class="input-group">
										
								<span id="a" class="input-group-addon" >车辆类型:</span>
								<input v-model="hqbmxz.chexing" type="text" class="form-control" aria-describedby="basic-addon3" style="vertical-align: middle ; width:160px; height:33px;">
									
							</div>
						</td>
						<td class="col-md-2"></td>
						<td class="col-md-2"></td>
						<td class="col-md-2"></td>
					</tr>
				</table>
				<table>
					<tr>
						<td class="col-md-2">
							<div class="input-group">
							
								<span id="a" class="input-group-addon" >当前里程:</span>
								<input v-model="hqbmxz.nowli" type="text" class="form-control" aria-describedby="basic-addon3" style="vertical-align: middle ; width:160px; height:33px;">
							
							</div>
						</td>
						<td class="col-md-2">
							<div class="input-group">
							
								<span id="a" class="input-group-addon" >选择班组:</span>
								<input v-model="hqbmxz.banid" type="text" class="form-control" aria-describedby="basic-addon3" disabled="true" style="vertical-align: middle ; width:160px; height:33px;">
							
							</div>
						</td>
						<td class="col-md-2">
							
							<button style="vertical-align: middle" data-toggle="modal" data-target="#xzbz">选择班组</button>
							
						</td>
						<td class="col-md-2"></td>
						<td class="col-md-2"></td>
						<td class="col-md-2"></td>
					</tr>
				</table>
				
			</div>
			
			<div class="row" id="tbss" style=" border: 1px solid #E6E6E6;height:360px;">
				<table id="ctx1" class="table table-hover table-bordered" style="width: 800px;" v-if="$perms('findwaiqin')">
					
					<tr id="c">
						<th>车牌号码</th>
						<th>车辆品牌</th>
						<th>车辆类型</th>
						<th>当前里程</th>
						<th>归属班组</th>
							
					</tr>			
					
					<tr v-for="item in wqcl" @click="tableDblclick(item)">
						<td>{{item.chepai}}</td>
						<td>{{item.carbank}}</td>
						<td>{{item.chexing}}</td>
						<td>{{item.nowli}}</td>
						<td>{{item.banid}}</td>
					</tr>
				</table>
				<div v-else class="alert alert-danger" role="alert">权限不足</div>
			</div>
		</div>
	</div>
<script type="text/javascript" src="js/jquery-1.12.4.js" ></script>
<script type="text/javascript" src="js/jquery.min.js"></script>
<script type="text/javascript" src="js/jquery.ztree.core.js"></script>
<script type="text/javascript" src="js/bootstrap.min.js"></script>
<script type="text/javascript" src="js/vue.js"></script>
<script type="text/javascript" src="js/my.js"></script>
<script type="text/javascript" src="js/perms.js" ></script>
<script type="text/javascript">
	
	var vm = new Vue({
		el: "#ctx",
		data() {
			return {
				wqcl:{},//获取外勤车辆
				hqbm:{banid:"",banname:""},//获取班组
				hqbmxz:{chepai:"",carbank:"",chexing:"",nowli:"",banid:""},//绑定文本框
				hqbmxz2:{chepai:"",carbank:"",chexing:"",nowli:"",banid:""}////绑定文本框
			}
		},
		created(){//
      		this.loading();//加载外勤车辆
      		this.bzszt();//加载班组树状图
   		},
		methods: {
			bzszt:function(){//获取初始树状图数据
				$.ajax({
					url: data.ip +"ncq/querybzszt",
					type: "get",
					dataType: "json",
					success: function(result) {
						console.log(result);
						$.fn.zTree.init($("#treeDemo"), setting, result);//初始化树节点时，添加同步获取的数据
						$.fn.zTree.init($("#treeDemo"), setting, result).expandAll(true);//树状图加载好默认打开所有节点
					},
					error: function(result) {
						console.log(result);
					}	
				});
			},
			loading:function() {//获取外勤车辆
				$.ajax({
					url: data.ip +"ncq/querywqcl",
						type: "get",
						dataType: "json",
					success: function(result) {
						vm.wqcl = result;
						console.log(result);
					},
					error: function(result) {
						console.log(result);
					}
				});
			},
			insert:function(){//新增外勤车辆
				if(vm.hqbmxz.chepai==null){
					alert("未输入车牌号码");
					return;
				}else if(vm.hqbmxz.chepai==""){	
					alert("未输入车牌号码");
					return;
				}else if(vm.hqbmxz.carbank==null){
					alert("未输入车辆品牌");
					return;
				}else if(vm.hqbmxz.carbank==""){	
					alert("未输入车辆品牌");
					return;
				}else if(vm.hqbmxz.chexing==null){
					alert("未输入车辆类型");
					return;
				}else if(vm.hqbmxz.chexing==""){	
					alert("未输入车辆类型");
					return;
				}else if(vm.hqbmxz.nowli==null){
					alert("未输入当前里程");
					return;
				}else if(vm.hqbmxz.nowli==""){	
					alert("未输入当前里程");
					return;
				}else if(vm.hqbmxz.banid==null){
					alert("未选择班组");
					return;
				}else if(vm.hqbmxz.banid==""){	
					alert("未选择班组");
					return;
				}else{
					$.ajax({
						url:data.ip +"ncq/insertwcql",
						type:"post",
						data:vm.hqbmxz,
						dataType:"text",
						success:function(result){
							console.log(result);
							if(result>0){
								alert("新增成功");
								for (var i in vm.hqbmxz) {
						        	vm.hqbmxz[i] = "";
						        }
							}else{
								alert("新增失败或着有重复车辆");
								for (var i in vm.hqbmxz) {
						        	vm.hqbmxz[i] = "";
						        }
							}
							vm.loading();
						},error:function(result){
							console.log(result);
						}
					});
				}
			},
			tableDblclick:function(item){//外勤车辆放入上方text框
				vm.hqbmxz.chepai=item.chepai;
				vm.hqbmxz.carbank=item.carbank;
				vm.hqbmxz.chexing=item.chexing;
				vm.hqbmxz.nowli=item.nowli;
				vm.hqbmxz.banid=item.banid;
				vm.hqbmxz2.chepai=item.chepai;
				vm.hqbmxz2.carbank=item.carbank;
				vm.hqbmxz2.chexing=item.chexing;
				vm.hqbmxz2.nowli=item.nowli;
				vm.hqbmxz2.banid=item.banid;
				console.log(vm.hqbmxz.chepai);
				console.log(vm.hqbmxz.carbank);
				console.log(vm.hqbmxz.chexing);
				console.log(vm.hqbmxz.nowli);
				console.log(vm.hqbmxz.banid);
				console.log(vm.hqbmxz2.chepai);
				console.log(vm.hqbmxz2.carbank);
				console.log(vm.hqbmxz2.chexing);
				console.log(vm.hqbmxz2.nowli);
				console.log(vm.hqbmxz2.banid);
			},
			up:function(){//修改外勤车辆
				if(vm.hqbmxz2.chepai==null){
					alert("请先选择一部车辆");
					return;
				}else if(vm.hqbmxz2.chepai==""){	
					alert("请先选择一部车辆");
					return;
				}else{
					console.log(vm.hqbmxz.chepai);
					console.log(vm.hqbmxz.carbank);
					console.log(vm.hqbmxz.chexing);
					console.log(vm.hqbmxz.nowli);
					console.log(vm.hqbmxz.banid);
					console.log(vm.hqbmxz2.chepai);
					$.ajax({
						url:data.ip +"ncq/upwqcl",
						type:"post",
						data:{chepai:vm.hqbmxz.chepai,carbank:vm.hqbmxz.carbank,chexing:vm.hqbmxz.chexing,nowli:vm.hqbmxz.nowli,banid:vm.hqbmxz.banid,ids:vm.hqbmxz2.chepai},
						dataType:"text",
						success:function(result){
							console.log(result);
							if(result>0){
								alert("修改成功");
								vm.hqbmxz2.chepai=vm.hqbmxz.chepai;
								for (var i in vm.hqbmxz) {
						        	vm.hqbmxz[i] = "";
						        }
							}else{
								alert("修改失败");
								for (var i in vm.hqbmxz) {
						        	vm.hqbmxz[i] = "";
						        }
							}
							vm.loading();
						},error:function(result){
							console.log(result);
						}
					});
				}
			},
			del:function(chepai){//删除外勤车辆
				if(vm.hqbmxz.chepai==null){
					alert("请先选择一部车辆");
					return;
				}else if(vm.hqbmxz.chepai==""){	
					alert("请先选择一部车辆");
					return;
				}else{
					$.ajax({
						url:data.ip +"ncq/delwqcl",
						type:"post",
						data:{chepai:chepai},
						dataType:"text",
						success:function(result){
							console.log(result);
							console.log(result);
							if(result>0){
								alert("删除成功");
								for (var i in vm.hqbmxz) {
						        	vm.hqbmxz[i] = "";
						        }
							}else{
								alert("删除失败");
								for (var i in vm.hqbmxz) {
						        	vm.hqbmxz[i] = "";
						        }
							}
							vm.loading();
						},error:function(result){
							console.log(result);
						}
					});
				}
			}
		}
	});
	
		//树状图
	var setting = {
		view: {
        	selectedMulti: true,
        	showIcon:false
    	},
		check: {
			enable: false
		},
		data: {
			key: {
                    name: "banname",//树节点name名称
                },
			simpleData: {
				enable: true,//是否采用简单数据模式
            	idKey: "banid",//树节点ID名称
            	pIdKey: "parentid",//父节点ID名称
            	rootPId: 0,//根节点ID
			}
		},
		 callback:{
			onClick:chooseNode,
		}
	};
	
	//点击树状图获取部门
	function chooseNode(event,treeId,treeNode){
		if (treeNode.parentid=="0") {
			return;
		}
		vm.hqbm=treeNode;
		vm.hqbmxz.banid=vm.hqbm.banid;
		console.log(vm.hqbm);
	}
	
</script>
</body>
</html>
