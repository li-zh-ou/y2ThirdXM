<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
	<head>
		<meta charset="UTF-8">
		<title>竣工检修</title>
		<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css"/>
	</head>
	<body>
		<div id="body">
			<div class="row">
				<h3 class="col-xs-offset-1 col-xs-9">竣工检修</h3>
				<button type="button" class="btn btn-success col-xs-1" onclick="load()" style="margin: 14px 0 0;">查询</button>
				<button type="button" class="btn btn-warning" style="margin: 14px 0 0 10px;">关闭</button>
			</div>
			<div class="page-header" style="border-bottom: 1px solid blue;"></div>
			<div>
				<p>
					<span>开单日期：</span><input type="date" id="pretime">至<input type="date" id="nexttime">
					<span>维修单号：</span><input type="text" id="wxdanno"/>
					<span>单据状态：</span><select id="danjustatu">
						<option value="">全部</option>
						<option value="作业中">待竣工车</option>
						<option value="已竣工">已竣工车</option>
						</select>
					<span>车牌号</span><input type="text" id="chepai"/>
				</p>
			</div>
			<div>
				<p style="text-align:right;margin-right:20px;font-size: 18px;">
					<a href="javascript:void(0)" onclick="toWeiXiuDan()">打开单据</a>
				</p>
			</div>
			<div class="row" style="overflow: scroll;">
				<table class="table table-hover table-bordered text-center " style="margin-left:20px;">
						<thead>
							<tr>
								<th></th>
								<th class="text-center">维修单号</th>
								<th class="text-center">单据状态</th>
								<th class="text-center">业务类型</th>
								<th class="text-center">客户名称</th>
								<th class="text-center">车牌号</th>
								<th class="text-center">手机</th>
								<th class="text-center">会员卡号</th>
								<th class="text-center">单据类型</th>
								<th class="text-center">开单时间</th>
								<th class="text-center">预计完工</th>
								<th class="text-center">完工时间</th>
							</tr>
						</thead>
						<tbody>
							<tr onclick="zyzclTr(this)" v-for="item in zuoyezhong">
								<td><input type="radio" name="jungong" disabled="disabled"></td>
								<td class="text-center">{{item.wxdanno}}</td>
								<td class="text-center">{{item.danjustatu}}</td>
								<td class="text-center">{{item.yewutype}}</td>
								<td class="text-center">{{item.kehuname}}</td>
								<td class="text-center">{{item.chepai}}</td>
								<td class="text-center">{{item.lianphone}}</td>
								<td class="text-center">{{item.huiyuanno}}</td>
								<td class="text-center">{{item.wxdantype}}</td>
								<td class="text-center">{{item.kaidantime}}</td>
								<td class="text-center">{{item.yujitime}}</td>
								<td class="text-center">{{item.wangongtime}}</td>
							</tr>
						</tbody>
					</table>
			</div>
		</div>
	</body>
	
	<script type="text/javascript" src="js/jquery-3.4.1.min .js" ></script>
	<script type="text/javascript" src="js/vue.js"></script>
	<script type="text/javascript" src="js/bootstrap.min.js" ></script>
	<script type="text/javascript" src="js/my.js"></script>
	<script type="text/javascript">
	var vm = new Vue({
		el:"#body",
		data(){
			return {
				zuoyezhong:[],
				selectedwxdanno:"",
				selectedchepai:"",
			}
		}
	})
	
	var timeoutID =null;
	var vmindex = null;
	//页面加载事件
	load();
		function load(){
			$.ajax({
				"url":"http://localhost:8080/weixiujieche/queryJunGong",
				"data":"wxdanno="+$("#wxdanno").val()+"&chepai="+$("#chepai").val()+"&danjustatu="+$("#danjustatu").val()+"&pretime="+$("#pretime").val()+"&nexttime="+$("#nexttime").val(),
				"success":function(result){
					vm.zuoyezhong=result;
				},
				"error":function(){
					alert("数据渲染失败444！");
				}
			})
		}
	
		
		//
		function toWeiXiuDan(){
			var Myiframe=document.createElement("iframe");
			Myiframe.setAttribute("style","position:fixed;z-index:999;top:0px;left:0px;width:100%;height:100%;");
			Myiframe.src="lWeiXiuDan.html";
			Myiframe.id="weixiudan";
			var mybody=document.getElementById("body");
			if(vmindex==null){
				alert("未选中任何单据");
				Myiframe = null;
				mybody = null;
				return;
			}
			vm.selectedwxdanno = vm.zuoyezhong[vmindex].wxdanno;
			vm.selectedchepai = vm.zuoyezhong[vmindex].chepai;
			mybody.append(Myiframe);
		}
		
		//表单tr的单选，选中和取消
		function zyzclTr(zyItem){
			clearTimeout(timeoutID);
			timeoutID = window.setTimeout(function (){
				vmindex = $(zyItem).index();
				if($("[name='jungong']")[vmindex].checked){
					$("[name='jungong']")[vmindex].checked=false;
					vmindex = null;
				}else{
					$("[name='jungong']")[vmindex].checked=true;
				}
			},300);
		}
	</script>
</html>
